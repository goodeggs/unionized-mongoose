// Generated by CoffeeScript 1.8.0
var Promise, buildFactoryFromSchema, faker, mongooseFactory, unionized;

unionized = require('unionized/src/unionized');

faker = require('faker');

Promise = require('bluebird');

buildFactoryFromSchema = function(schema, types) {
  var definition, embedArray, promises;
  definition = this;
  embedArray = Promise.promisify(definition.embedArray, definition);
  promises = [];
  schema.eachPath(function(pathName, schemaType) {
    switch (false) {
      case !(schemaType instanceof types.String && pathName === 'name'):
        return definition.set(pathName, faker.Name.findName());
      case !(schemaType instanceof types.String):
        return definition.set(pathName, faker.Lorem.words().join(' '));
      case !(schemaType instanceof types.Number):
        return definition.set(pathName, faker.random.number(100));
      case !(schemaType instanceof types.DocumentArray):
        return promises.push(embedArray(pathName, 2, unionized.define(function(callback) {
          return buildFactoryFromSchema.call(this, schemaType.schema).nodeify(callback);
        })));
    }
  });
  return Promise.all(promises);
};

module.exports = mongooseFactory = function(Model) {
  return unionized.define(Model, function(callback) {
    var mongoose;
    mongoose = Model.db.base;
    return buildFactoryFromSchema.call(this, Model.schema, mongoose.SchemaTypes).nodeify(callback);
  });
};
